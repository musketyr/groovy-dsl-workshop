<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.0">
<meta name="author" content="Vladimír Oraný">
<title>Groovy DSL Workshop</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-check-square-o:first-child,ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after,a[href^="mailto:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
<link rel="stylesheet" href="css/groovy-dsl-workshop.css?v=1.0.0" />
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68778580-1', 'auto');
    ga('send', 'pageview');

</script>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Groovy DSL Workshop</h1>
<div class="details">
<span id="author" class="author">Vladimír Oraný</span><br>
<span id="email" class="email"><a href="https://github.com/musketyr"><span class="icon"><i class="fa fa-github"></i></span> @musketyr</a></span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_getting_started">Getting Started</a>
<ul class="sectlevel2">
<li><a href="#_software_requirements">Software Requirements</a></li>
<li><a href="#_project_archive">Project Archive</a></li>
</ul>
</li>
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_1_self_managed_content">1. Self-managed Content</a>
<ul class="sectlevel2">
<li><a href="#_tasks">Tasks</a></li>
</ul>
</li>
<li><a href="#_2_basic_java_dsl">2. Basic Java DSL</a>
<ul class="sectlevel2">
<li><a href="#_tasks_2">Tasks</a></li>
</ul>
</li>
<li><a href="#_3_basic_groovy_dsl">3. Basic Groovy DSL</a>
<ul class="sectlevel2">
<li><a href="#_tasks_3">Tasks</a></li>
</ul>
</li>
<li><a href="#_4_bonus_designing_for_extendability">4. [Bonus] Designing for Extendability</a>
<ul class="sectlevel2">
<li><a href="#_tasks_4">Tasks</a></li>
</ul>
</li>
<li><a href="#_5_bonus_api_clean_up">5. [Bonus] API Clean Up</a>
<ul class="sectlevel2">
<li><a href="#_tasks_5">Tasks</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_getting_started">Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this workshop we will learn how to create domain specific languages (DSL) in Groovy.
We will create builder-pattern style DSL with nested blocks which perfectly suits the Groovy language.
All the code exercises are written in Java so no previous knowledge of Groovy is required.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>The builder pattern is used to create complex objects with constituent parts that must be created in the same order or using a specific algorithm. An external class controls the construction algorithm. — The Gang of Four</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We will use <a href="https://yuml.me/">yUML diagrams</a> (data class diagrams) as a reference domain model.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/yuml-diagram.png" alt="yUML Diagram&#8217;s Model"></span></p>
</div>
<div class="paragraph">
<p>This workshop is based on <strong>Groovy DSL Builders</strong> series which can be used as reference documentation:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://medium.com/p/2d5a97fa0a51">The Concept: The core concept of builders</a></p>
</li>
<li>
<p><a href="https://medium.com/p/fda1f2ebe657">The Essence: The closures' basics</a></p>
</li>
<li>
<p><a href="https://medium.com/p/df2e9a02557a">The Aid: Using the annotations for static compilation</a></p>
</li>
<li>
<p><a href="https://medium.com/p/1e2edc2311f8">The Disguise: Hiding the implementation of the builder API</a></p>
</li>
<li>
<p><a href="https://medium.com/p/afb47ebbf89d">The Desiccation: Keeping the code DRY</a></p>
</li>
<li>
<p><a href="https://medium.com/p/83ced4b8f2b">The Expectations: The importance of handling closures' owner properly</a></p>
</li>
<li>
<p><a href="https://medium.com/p/d612fd261471">The Extension: Designing your builder DSL for extendability</a></p>
</li>
<li>
<p><a href="https://medium.com/p/99bd118538b4">The Resignation: Rewriting the Groovy DSL builder into Java</a></p>
</li>
<li>
<p><a href="https://medium.com/p/d065f0253e98">The Navigation: Using the annotations for named parameters</a></p>
</li>
<li>
<p><a href="https://medium.com/p/9d2b961dbc55">The Conclusion: The checklist for Groovy DSL builders' authors</a></p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_software_requirements">Software Requirements</h3>
<div class="paragraph">
<p>To get started you need to have installed following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">Java Development Kit 8</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Project is built using <a href="https://gradle.org/">Gradle</a> build tool but it&#8217;s using <a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html">Gradle Wrapper</a>
so you are not required to install it manually nor you don&#8217;t have to be afraid of version clash.</p>
</div>
<div class="paragraph">
<p>You can use IDE of your choice but <a href="https://www.jetbrains.com/idea/">IntelliJ IDEA</a> provides so far the best
Gradle and Groovy integration even in the free Community version. Import the project as Gradle project get the best developer experience.</p>
</div>
</div>
<div class="sect2">
<h3 id="_project_archive">Project Archive</h3>
<div class="paragraph">
<p>To get started download <a href="archives/groovy-dsl-workshop.zip">exercise project archive file</a> and unzip it. Run following command to get all dependencies downloaded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./gradlew dependencies</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can execute tests by running following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code>./gradlew test</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There are several sub-projects called <code>step-xx</code> in the archive where <code>xx</code> is number
of the exercise. Each of the exercises is covered by a single test which will pass only if you have successfully finished
all the tasks. Each sub-project contains ideal solution of the previous exercise so in case of you get stuck or
you want to skip an exercise for any reason you get everything you need to keep coding.
Of course you can continue working on your own code. In that case, you can simply copy the test from the next step into
your current sub-project.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this workshop, we are going to create DSL for <a href="https://yuml.me/">yUML.me</a> diagrams.
yUML helps to create simple UML diagram online.</p>
</div>
<div class="listingblock">
<div class="title">YUML Diagram&#8217;s Syntax Example</div>
<div class="content">
<pre>[note: You can stick notes on diagrams too!{bg:cornsilk}]
[Customer]&lt;&gt;1-orders 0..*&gt;[Order]
[Order]++*-*&gt;[LineItem]
[Order]-1&gt;[DeliveryMethod]
[Order]*-*&gt;[Product]
[Category]&lt;-&gt;[Product]
[DeliveryMethod]^[National]
[DeliveryMethod]^[International]</pre>
</div>
</div>
<div class="paragraph">
<p>Its simplified data model is shown in the following diagram:</p>
</div>
<div class="paragraph">
<div class="title">YUML Diagram&#8217;s Model</div>
<p><span class="image"><img src="images/yuml-diagram.png" alt="yUML Diagram&#8217;s Model"></span></p>
</div>
<div class="paragraph">
<p>Although we are implementing Groovy DSL the DSL code will be written in Java. This approach will help us
to reach greater audience and help us avoid <a href="https://medium.com/p/83ced4b8f2b">some common pitfalls</a> more easily.
See <a href="https://medium.com/p/99bd118538b4">The Resignation: Rewriting the Groovy DSL builder into Java</a> for further reference on writing Groovy DSLs in Java.</p>
</div>
<div class="paragraph">
<p>First, we should get familiar with the data model in <code>cz.orany.yuml.model</code> package.</p>
</div>
<div class="paragraph">
<p><code>Diagram</code> represents the diagram which can contain notes, types and their relationships.</p>
</div>
<div class="listingblock">
<div class="title">Diagram.java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public class Diagram {

    private Collection&lt;Note&gt; notes = new LinkedHashSet&lt;&gt;();
    private Collection&lt;Type&gt; types = new LinkedHashSet&lt;&gt;();
    private Collection&lt;Relationship&gt; relationships = new LinkedHashSet&lt;&gt;();

    // boilerplate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Note</code> is a simple box placed next to the diagram which can have it&#8217;s <code>text</code> and <code>color</code>.</p>
</div>
<div class="listingblock">
<div class="title">Note.java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public class Note {

    private String text;
    private String color;

    // boilerplate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Relationship</code> represents relationship between two types. Each relationship has
it&#8217;s <code>type</code>, <code>source</code> and <code>destination</code>. Relationships can be <code>bidirectional</code>. You can specify
cardinality and title for the <code>source</code> and <code>destination</code></p>
</div>
<div class="listingblock">
<div class="title">Relationship.java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public class Relationship {

    private RelationshipType type = RelationshipType.ASSOCIATION;
    private boolean bidirectional;
    private Type source;
    private String sourceCardinality;
    private String sourceTitle;
    private Type destination;
    private String destinationCardinality;
    private String destinationTitle;

    // boilerplate
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">RelationshipType.java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">package cz.orany.yuml.model;

public enum RelationshipType {
    ASSOCIATION, AGGREGATION, COMPOSITION, INHERITANCE;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Type</code> is a data class determined by it&#8217;s <code>name</code>.</p>
</div>
<div class="listingblock">
<div class="title">Type.java</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public class Type {

    private String name;

    // boilerplate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Following example shows how verbose is creating the diagram without any DSL improvements:</p>
</div>
<div class="listingblock">
<div class="title">Creating Diagram using Constructors</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy" data-lang="groovy">Diagram diagram =  new Diagram()

diagram.notes.add(new Note(
    text: 'You can stick notes on diagrams too!',
    color: 'skyblue'
))

Type customer = new Type(name: 'Customer')
Type order = new Type(name: 'Order')
Type lineItem = new Type(name: 'LineItem')
Type deliveryMethod = new Type(name: 'DeliveryMethod')
Type product = new Type(name: 'Product')
Type category = new Type(name: 'Category')
Type nationalDeliveryMethod = new Type(name: 'National')
Type internationalDeliveryMethod = new Type(name: 'International')

diagram.types.add(customer)
diagram.types.add(order)
diagram.types.add(lineItem)
diagram.types.add(deliveryMethod)
diagram.types.add(product)
diagram.types.add(category)
diagram.types.add(nationalDeliveryMethod)
diagram.types.add(internationalDeliveryMethod)

diagram.relationships.add(new Relationship(
    source: customer,
    sourceCardinality: '1',
    destinationTitle: 'orders',
    destination: order,
    destinationCardinality: '0..*',
    type: RelationshipType.AGGREGATION
))

diagram.relationships.add(new Relationship(
    source: order,
    sourceCardinality: '*',
    destination: lineItem,
    destinationCardinality: '*',
    type: RelationshipType.COMPOSITION
))

diagram.relationships.add(new Relationship(
    source: order,
    destination: deliveryMethod,
    destinationCardinality: '1'
))

diagram.relationships.add(new Relationship(
    source: order,
    sourceCardinality: '*',
    destination: product,
    destinationCardinality: '*'
))

diagram.relationships.add(new Relationship(
    source: category,
    destination: product,
    bidirectional: true
))

diagram.relationships.add(new Relationship(
    source: nationalDeliveryMethod,
    destination: deliveryMethod,
    type: RelationshipType.INHERITANCE
))

diagram.relationships.add(new Relationship(
    source: internationalDeliveryMethod,
    destination: deliveryMethod,
    type: RelationshipType.INHERITANCE
))</code></pre>
</div>
</div>
<div class="paragraph">
<p>The initial version is very verbose and there is definitely lot of place for the improvement in future steps.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_1_self_managed_content">1. Self-managed Content</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The most of the verbosity of the initial example originates from manual handling
of diagram&#8217;s content - relationships, notes and types. Let&#8217;s make <code>Diagram</code> class responsible for managing these items.
Let&#8217;s create methods <code>note</code>, <code>type</code>, <code>relationship</code> which will internally create or reuse existing parts of the
diagram:</p>
</div>
<div class="listingblock">
<div class="title">Diagram Responsible for Content Management</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy" data-lang="groovy">Diagram diagram =  new Diagram().with {
    note('You can stick notes on diagrams too!','skyblue')

    relationship(type('Customer'), RelationshipType.AGGREGATION, type('Order')).with {
        sourceCardinality = '1'
        destinationTitle = 'orders'
        destinationCardinality = '0..*'
    }

    relationship(type('Order'), RelationshipType.COMPOSITION, type('LineItem')).with {
        sourceCardinality = '*'
        destinationCardinality = '*'
    }

    relationship(type('Order'), type('DeliveryMethod')).with {
        destinationCardinality = '1'
    }

    relationship(type('Order'), type('Product')).with {
        sourceCardinality = '*'
        destinationCardinality ='*'
    }

    relationship(type('Category'), type('Product')).with {
        bidirectional = true
    }

    relationship(type('National'), RelationshipType.INHERITANCE, type('DeliveryMethod'))
    relationship(type('International'), RelationshipType.INHERITANCE, type('DeliveryMethod'))

    it
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Methods <code>note</code>, <code>type</code> and <code>relationship</code> are now responsible for creating or referencing the particular content of the diagram.
The example uses default Groovy method <code>with</code> simplify accessing diagram&#8217;s parts properties. In the next step, we are going to
replace method <code>with</code> with our own implementation.</p>
</div>
<div class="sect2">
<h3 id="_tasks">Tasks</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement methods <code>note</code>, <code>type</code> and <code>relationship</code> in <code>Diagram</code> class to manage diagram content. Methods must not create duplicates for the same input.</p>
</li>
<li>
<p>Make <code>Diagram01Spec</code> passing.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find solution <a href="solutions/01.html">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_basic_java_dsl">2. Basic Java DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this step we are going to replace calling <code>with</code> method with custom methods.
As we write your DSL code in Java we start with implementation using <code>Consumer</code>
functional interface which will pass the instance being configured (e.g. <code>Relationship</code>) into the single absract method
<code>accept</code>. As <code>Consumer</code> is functional interface we can use Java lambda syntax. After that, we will get closer to desired tree-like structure of the code.</p>
</div>
<div class="listingblock">
<div class="title">Java Version of the DSL</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">private Diagram buildDiagram() {
    return Diagram.create(d -&gt; {
        d.note("You can stick notes on diagrams too!", "skyblue");

        d.aggregation("Customer", "Order", r -&gt; {
            r.source("1");
            r.destination("0..*", "orders");
        });

        d.composition("Order", "LineItem", r -&gt; {
            r.source("*");
            r.destination("*");
        });

        d.association("Order", "DeliveryMethod", r -&gt; {
            r.destination("1");
        });

        d.association("Order", "Product", r -&gt; {
            r.source("*");
            r.destination("*");
        });

        d.association("Category", "Product", r -&gt; {
            r.bidirectional(true);
        });

        d.type("National").inherits(from).type("DeliveryMethod");
        d.type("International").inherits(from).type("DeliveryMethod");
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see there are many new methods accepting lambda expressions.
They all simplifies calling the base method <code>relationship</code>:</p>
</div>
<div class="listingblock">
<div class="title">Methods Accepting Consumer</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public Relationship relationship(
        String source,
        RelationshipType type,
        String destination,
        Consumer&lt;Relationship&gt; configuration
) {
    Relationship relationship = new Relationship(type(source), type, type(destination));
    configuration.accept(relationship);
    relationships.add(relationship);
    return relationship;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Declaring inheritance is handled using a fluent DSL. Fluent DSL uses a feature called
<a href="http://docs.groovy-lang.org/docs/latest/html/documentation/core-domain-specific-languages.html#_command_chains">Command Chains</a>
which allows to skip the parentheses.</p>
</div>
<div class="paragraph">
<p>Method <code>inherits</code> is just a very simple method of <code>Type</code> which returns instance of <code>InheritanceBuilder</code>
which handles rest of the DSL statement.</p>
</div>
<div class="listingblock">
<div class="title">Method <code>inherits</code></div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public InheritanceBuilder inherits(DiagramKeywords.From from) {
    return new InheritanceBuilder(diagram, this);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>InheritanceBuilder</code> is a helper class to specify the rest of the information. <code>From</code> is just an enum
with single value <code>FROM</code> which is passed into the DSL from static import.</p>
</div>
<div class="listingblock">
<div class="title">Class <code>InheritanceBuilder</code></div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">package cz.orany.yuml.model;

public class InheritanceBuilder {

    private final Diagram diagram;
    private final Type type;

    public InheritanceBuilder(Diagram diagram, Type type) {

        this.diagram = diagram;
        this.type = type;
    }

    public Relationship type(String parent) {
        return diagram.inheritance(type.getName(), parent, c-&gt; {});
    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_2">Tasks</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Implement methods <code>association</code>, <code>aggregation</code>, <code>inheritance</code> and <code>composition</code> accepting <code>Consumer</code> in <code>Diagram</code> class for building different kinds of relationships.</p>
</li>
<li>
<p>Implement static method <code>create</code> in <code>Diagram</code> class which is accepting <code>Consumer</code> to build the whole diagram.</p>
</li>
<li>
<p>Practise implementing the fluent DSL for creating inheritance (feel free to copy &amp; paste it from the snippets above)</p>
</li>
<li>
<p>Make <code>Diagram02Test</code> passing.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find solution <a href="solutions/02.html">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_basic_groovy_dsl">3. Basic Groovy DSL</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is quite easy to add groovy DSL extension once we have methods accepting functional types. Here is an example of
the desired DSL in Groovy.</p>
</div>
<div class="listingblock">
<div class="title">Groovy Version of the DSL</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy" data-lang="groovy">@CompileStatic                                                                      <i class="conum" data-value="1"></i><b>(1)</b>
private static Diagram buildOrderDiagram() {
    Diagram.build { Diagram d -&gt;                                                    <i class="conum" data-value="2"></i><b>(2)</b>
        note('You can stick notes on diagrams too!', 'skyblue')

        aggregation('Customer', 'Order') {                                          <i class="conum" data-value="3"></i><b>(3)</b>
            source cardinality: '1'                                                 <i class="conum" data-value="4"></i><b>(4)</b>
            destination cardinality: '0..*', title: 'orders'
        }

        buildOrderTypes(d)                                                          <i class="conum" data-value="5"></i><b>(5)</b>

        association('Category', 'Product') {
            bidirectional true
        }

        type 'National' inherits from type 'DeliveryMethod'
        type 'International' inherits from type 'DeliveryMethod'
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The goal is to give the static compiler enough hints to be able to compile the code statically</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>New static method in the <code>Diagram</code> class which delegates the closure to the instance of <code>Diagram</code> class and which passes the same instance of <code>Diagram</code> class as a single parameter of the closure</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>New method in the <code>Diagram</code> class which helps building a <code>Relationship</code></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>New method in the <code>Relationship</code> class which accepts named arguments and helps specifying the cardinality and title</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The closure parameter <code>Diagram d</code> can be used extract parts of the diagram definition to separate method</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is a good practise not to mix Java API and Groovy API together so let&#8217;s use <a href="http://groovy-lang.org/metaprogramming.html#_extension_modules">Groovy Extension Modules</a>
to add additional methods to our current Java API.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s create a extension module descriptor text file called <code>org.codehaus.groovy.runtime.ExtensionModule</code> in <code>src/main/resources/META-INF/services/</code></p>
</div>
<div class="listingblock">
<div class="title">Extension Module Descriptor</div>
<div class="content">
<pre>moduleName=yuml-extra
moduleVersion=0.1.0
extensionClasses=cz.orany.yuml.groovy.DiagramExtensions
staticExtensionClasses=cz.orany.yuml.groovy.DiagramStaticExtensions</pre>
</div>
</div>
<div class="paragraph">
<p>Obviously we need create two new classes as well - <code>DiagramStaticExtensions</code> and <code>DiagramExtensions</code>. We will use annotations
described in <a href="https://medium.com/p/df2e9a02557a">The Aid: Using the annotations for static compilation</a> to add a hints for the
static compiler and also the IDE.</p>
</div>
<div class="listingblock">
<div class="title">Static Extension Class</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">package cz.orany.yuml.groovy;

import cz.orany.yuml.model.Diagram;
import cz.orany.yuml.model.DiagramContent;
import cz.orany.yuml.model.DiagramKeywords;
import groovy.lang.Closure;
import groovy.lang.DelegatesTo;
import groovy.transform.stc.ClosureParams;
import groovy.transform.stc.SimpleType;
import space.jasan.support.groovy.closure.ConsumerWithDelegate;

public class DiagramStaticExtensions {

    public static Diagram build(                                                        <i class="conum" data-value="1"></i><b>(1)</b>
        Diagram self,                                                                   <i class="conum" data-value="2"></i><b>(2)</b>
        @DelegatesTo(value = Diagram.class, strategy = Closure.DELEGATE_FIRST)          <i class="conum" data-value="3"></i><b>(3)</b>
        @ClosureParams(value=SimpleType.class, options="cz.orany.yuml.model.Diagram")   <i class="conum" data-value="4"></i><b>(4)</b>
        Closure&lt;? extends DiagramContent&gt; definition                                    <i class="conum" data-value="5"></i><b>(5)</b>
    ) {
        return Diagram.create(ConsumerWithDelegate.create(definition));                 <i class="conum" data-value="6"></i><b>(6)</b>
    }

    public static DiagramKeywords.From getFrom(Diagram self) {                          <i class="conum" data-value="7"></i><b>(7)</b>
        return DiagramKeywords.From.FROM;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add a new static method called <code>build</code> &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; to the <code>Diagram</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@DelegatesTo</code> tells the compiler and IDE which object will be send as a delegate</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@ClosureParams</code> tells the compiler and IDE which object will be passed as closure parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Return value of the closure should be the common type of the return values of every possible DSL statement to prevent unfinished statements such as <code>type 'Type' inherits from</code></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td><code>ConsumerWithDelegates</code> is a helper class from <a href="https://github.com/jasanspace/groovy-closure-support">Groovy Closure Support</a> library which helps using
closures with methods which accepts common Java functional interfaces such as <code>Consumer</code></td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Shortcut to <code>from</code> keyword so no static imports are required in Groovy code</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please, pay attention that the name of the static method added to <code>Diagram</code> class is different (<code>build</code>) then
the one accepting <code>Consumer</code> (<code>create</code>). There is a bug in groovy which prevents overloading static methods.
The restriction does not apply on the instance methods.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You may notice that in the example we also used a new methods <code>source</code> and <code>destination</code> accepting map as a parameter.
We can define additional checks to this methods using annotations mentioned in <a href="https://medium.com/p/d065f0253e98">The Navigation: Using the annotations for named parameters</a>.</p>
</div>
<div class="listingblock">
<div class="title">Extension Class</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public class DiagramExtensions {

    private static final String CARDINALITY = "cardinality";
    private static final String TITLE = "title";

    public static Relationship relationship(
            Diagram diagram,
            String source,
            RelationshipType type,
            String destination,
            @DelegatesTo(value = Relationship.class, strategy = Closure.DELEGATE_FIRST)
            @ClosureParams(value = SimpleType.class, options = "cz.orany.yuml.model.Relationship")
            Closure&lt;Relationship&gt; configuration
    ) {
        return diagram.relationship(source, type, destination, ConsumerWithDelegate.create(configuration));
    }


    public static Relationship source(                                                  <i class="conum" data-value="1"></i><b>(1)</b>
            Relationship self,                                                          <i class="conum" data-value="2"></i><b>(2)</b>
            @NamedParams({                                                              <i class="conum" data-value="3"></i><b>(3)</b>
                    @NamedParam(value = CARDINALITY, type = String.class),              <i class="conum" data-value="4"></i><b>(4)</b>
                    @NamedParam(value = TITLE, type = String.class)
            })
                    Map&lt;String, String&gt; cardinalityAndTitle                             <i class="conum" data-value="5"></i><b>(5)</b>
    ) {
        return self.source(
                cardinalityAndTitle.get(CARDINALITY),
                cardinalityAndTitle.get(TITLE)
        );
    }

    // rest of the methods
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Add a new method called <code>source</code> &#8230;&#8203;</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>&#8230;&#8203; to the <code>Relationship</code> class</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td><code>@NamedParams</code> aggregates the possible named parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>For example parameter <code>cardinality</code> of type <code>String</code></td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The argument itself is still just plain old <code>Map</code></td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_tasks_3">Tasks</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using a static extension class, add a static method <code>build</code> accepting closure to the <code>Diagram</code> class</p>
</li>
<li>
<p>Using a static extension class, add a shortcut keyword <code>from</code> to the <code>Diagram</code> class (i.e. <code>getFrom</code> method)</p>
</li>
<li>
<p>Using an extension class, add methods for creating different types of relationships to the <code>Diagram</code> class which accept closures</p>
</li>
<li>
<p>Using an extension class, add methods <code>source</code> and <code>destination</code> which accepts named parameters to specify cardinality and title into the <code>Relationship</code> class</p>
</li>
<li>
<p>Make <code>Diagram03Spec</code> passing</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find solution <a href="solutions/03.html">here</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_bonus_designing_for_extendability">4. [Bonus] Designing for Extendability</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>This is and advanced exercise. Feel free to ignore it or just read through it if you don&#8217;t feel comfortable trying to implement this step.</em></p>
</div>
<div class="paragraph">
<p>A good DSL is open and provides enough extension points to allow developers to extend the original functionality. Please, read
<a href="https://medium.com/p/d612fd261471">The Extension: Designing your builder DSL for extendability</a> to better understand the mechanism of
creating extendable DSL.</p>
</div>
<div class="paragraph">
<p>For example, some developers would like to add support for stereotypes and properties.</p>
</div>
<div class="listingblock">
<div class="title">Groovy Version of the DSL</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-groovy" data-lang="groovy">@CompileStatic
private static Diagram buildDiagramStereotypesAndProperties() {
    Diagram.build { Diagram d -&gt;
        note('You can stick notes on diagrams too!', 'skyblue')

        aggregation('Customer', 'Order') {
            source cardinality: '1'
            destination cardinality: '0..*', title: 'orders'
        }

        buildOrderTypes(d)

        association('Category', 'Product') {
            bidirectional true
        }

        type 'National' inherits from stereotype 'DeliveryMethod'                   <i class="conum" data-value="1"></i><b>(1)</b>
        type 'International' inherits from stereotype 'DeliveryMethod'

        type('Customer') {
            property 'string', 'name'                                               <i class="conum" data-value="2"></i><b>(2)</b>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declaring a stereotype</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declaring type&#8217;s properties</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Adding support for stereotype is pretty simple. Stereotype is just a type surrounded by <code>&lt;&lt;</code> and <code>&gt;&gt;</code>. We can achieve this
directly in the extension class.</p>
</div>
<div class="listingblock">
<div class="title">Stereotype Extensions</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public static Type stereotype(Diagram self, String name) {
    return self.type("&lt;&lt;" + name + "&gt;&gt;");
}

public static Relationship stereotype(InheritanceBuilder self, String name) {
    return self.type("&lt;&lt;" + name + "&gt;&gt;");
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Adding support for the properties requires more steps. First we need to declare an interface for <em>helper</em>
objects which can gather the metadata for diagram.</p>
</div>
<div class="listingblock">
<div class="title">Diagram Helper</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">package cz.orany.yuml.model;

import java.util.Map;

public interface DiagramHelper {

    Map&lt;String, Object&gt; getMetadata();

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>These helpers can be added to the diagram and they simplifies access to the generic <code>metadata</code> map:</p>
</div>
<div class="listingblock">
<div class="title">Diagram Helpers and Metadata</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public static Diagram create(Consumer&lt;Diagram&gt; diagramConsumer) {
    Diagram diagram = new Diagram();
    diagramConsumer.accept(diagram);
    diagram.postprocess();                                                          <i class="conum" data-value="1"></i><b>(1)</b>
    return diagram;
}

public Map&lt;String, Object&gt; getMetadata() {                                          <i class="conum" data-value="2"></i><b>(2)</b>
    return metadata;
}

public &lt;H extends DiagramHelper, R&gt; R configure(                                    <i class="conum" data-value="3"></i><b>(3)</b>
        Class&lt;H&gt; helper,
        Function&lt;H, R&gt; configurationOrQuery
) {
    H helperInstance = (H) helperMap.computeIfAbsent(helper, (h) -&gt; {
        try {
            return (DiagramHelper) h.newInstance();
        } catch (InstantiationException | IllegalAccessException e) {
            throw new IllegalArgumentException("Cannot instantiate " + h, e);
        }
    });

    return configurationOrQuery.apply(helperInstance);
}

void postprocess() {                                                                <i class="conum" data-value="4"></i><b>(4)</b>
    for (DiagramHelper helper : helperMap.values()) {
        metadata.putAll(helper.getMetadata());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Method <code>postprocess</code> is called when the build phase of the DSL is finished</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Metadata are just a generic map with string keys</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Method <code>configure</code> instantiates or reuses existing helper instance and executes some code on helper instance and returns the result</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Method <code>postprocess</code> iterates all the existing helpers and gathers the metadata</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we can create a helper to store the metadata for given type:</p>
</div>
<div class="listingblock">
<div class="title">Properites Helper</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">package cz.orany.yuml.model;

import java.util.Collections;
import java.util.LinkedHashMap;
import java.util.Map;

public class PropertiesDiagramHelper implements DiagramHelper {

    private static final String METADATA_KEY
            = "cz.orany.yuml.properties.PropertiesDiagramHelper.typeToProperties";

    private final Map&lt;String, Map&lt;String, String&gt;&gt; typeToProperties                     <i class="conum" data-value="1"></i><b>(1)</b>
            = new LinkedHashMap&lt;&gt;();

    public PropertiesDiagramHelper addProperty(String owner, String type, String name) {<i class="conum" data-value="2"></i><b>(2)</b>
        Map&lt;String, String&gt; properties = typeToProperties.computeIfAbsent(
                owner, (key) -&gt; new LinkedHashMap&lt;&gt;()
        );

        properties.put(name, type);

        return this;
    }

    @Override
    public Map&lt;String, Object&gt; getMetadata() {
        return Collections.singletonMap(METADATA_KEY, typeToProperties);                <i class="conum" data-value="3"></i><b>(3)</b>
    }

    @SuppressWarnings("unchecked")
    public static Map&lt;String, String&gt; getProperties(Diagram diagram, Type type) {       <i class="conum" data-value="4"></i><b>(4)</b>
        Map&lt;String, Map&lt;String, String&gt;&gt; typeToProperties = (Map&lt;String, Map&lt;String, String&gt;&gt;) diagram
                .getMetadata()
                .computeIfAbsent(METADATA_KEY, (key) -&gt; new LinkedHashMap&lt;&gt;());
        return typeToProperties.computeIfAbsent(type.getName(), (key) -&gt; new LinkedHashMap&lt;&gt;());
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Properties for each type are held in a map</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adds a property to the given type</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Returns the metadata provided by this helper - the map of the types and their properties</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Returns the properties of given type</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we have finally everything to add the method for adding type&#8217;s properties. This is also implemented as extension method:</p>
</div>
<div class="listingblock">
<div class="title">Property Extensions</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">public static Type property(Type typeDefinition, String type, String name) {
    typeDefinition.getDiagram().configure(PropertiesDiagramHelper.class, (h) -&gt;
        h.addProperty(typeDefinition.getName(), type, name)
    );
    return typeDefinition;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last step is to update the class responsible for printing the diagram to take the properties into an account:</p>
</div>
<div class="listingblock">
<div class="title">YUML Priter with Properties</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">private String print(Diagram diagram, Type type) {
    Map&lt;String, String&gt; properties = PropertiesDiagramHelper.getProperties(diagram, type);

    if (properties.isEmpty()) {
        return String.format("[%s]", type.getName());
    }

    String propertiesFormatted = properties
            .entrySet()
            .stream()
            .map((e) -&gt; e.getKey() + ":" + e.getValue())
            .collect(Collectors.joining(";"));

    return String.format(
            "[%s|%s]",
            type.getName(),
            propertiesFormatted
    );
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_tasks_4">Tasks</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Using an extension class, add a method <code>stereotype</code> to the Groovy DSL</p>
</li>
<li>
<p>Using an extension class, add a ability to specify type&#8217;s properties to the Groovy DSL</p>
</li>
<li>
<p>Update the printer class to print types' properties</p>
</li>
<li>
<p>Make <code>Diagram04Spec</code> passing.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find the solution in the <code>step-05/src/main/java/</code> source codes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_5_bonus_api_clean_up">5. [Bonus] API Clean Up</h2>
<div class="sectionbody">
<div class="paragraph">
<p><em>This is and advanced and quite stereotype exercise. Feel free to ignore it or just read through it if you don&#8217;t feel comfortable trying to implement this step.</em></p>
</div>
<div class="paragraph">
<p>The current version of the DSL allows calling all the operations of the diagram objects inside the definition.
It is a good practice to split the methods for reading and the methods for defining the diagram into two separate
interfaces.</p>
</div>
<div class="paragraph">
<p>See the following <code>Diagram</code> and <code>DiagramDefinition</code> classes:</p>
</div>
<div class="listingblock">
<div class="title">Read Operations</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">package cz.orany.yuml.model;

import java.util.Collection;
import java.util.Map;
import java.util.function.Consumer;

public interface Diagram {

    static Diagram create(Consumer&lt;DiagramDefinition&gt; diagramConsumer) {
        return DefaultDiagram.create(diagramConsumer);
    }

    Collection&lt;Note&gt; getNotes();

    Collection&lt;Type&gt; getTypes();

    Collection&lt;Relationship&gt; getRelationships();

    Map&lt;String, Object&gt; getMetadata();

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Definition Operations</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-java" data-lang="java">package cz.orany.yuml.model;

import java.util.function.Consumer;
import java.util.function.Function;

public interface DiagramDefinition {

    default Note note(String text) {
        return note(text, null);
    }

    Note note(String text, String color);

    TypeDefinition type(String name);

    default TypeDefinition type(String name, Consumer&lt;TypeDefinition&gt; configuration) {
        TypeDefinition type = type(name);
        configuration.accept(type);
        return type;
    }

    default Relationship association(String source, String destination, Consumer&lt;RelationshipDefinition&gt; configuration) {
        return relationship(source, RelationshipType.ASSOCIATION, destination, configuration);
    }

    default Relationship aggregation(String source, String destination, Consumer&lt;RelationshipDefinition&gt; configuration) {
        return relationship(source, RelationshipType.AGGREGATION, destination, configuration);
    }

    default Relationship inheritance(String source, String destination, Consumer&lt;RelationshipDefinition&gt; configuration) {
        return relationship(source, RelationshipType.INHERITANCE, destination, configuration);
    }

    default Relationship composition(String source, String destination, Consumer&lt;RelationshipDefinition&gt; configuration) {
        return relationship(source, RelationshipType.COMPOSITION, destination, configuration);
    }

    Relationship relationship(String source, RelationshipType type, String destination, Consumer&lt;RelationshipDefinition&gt; configuration);

    &lt;H extends DiagramHelper, R&gt; R configure(Class&lt;H&gt; helper, Function&lt;H, R&gt; configurationOrQuery);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we are developing for version Java 8 and later we can move some methods directly into the <code>DiagramDefinition</code> class. All the consumers
now uses <code>*Definition</code> interfaces only.</p>
</div>
<div class="sect2">
<h3 id="_tasks_5">Tasks</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Separate the read and definition roles of the diagram using interfaces</p>
</li>
<li>
<p>Make <code>Diagram05Spec</code> passing</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can find the solution in the <code>step-99/src/main/java/</code> source codes.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2019-05-28 06:48:14 +00:00
</div>
</div>
</body>
</html>